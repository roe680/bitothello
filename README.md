# ビット オセロ (BitOthello)

高速なビット演算を使用したオセロ（リバーシ）ゲームです。AI対戦機能と詳細なゲーム統計のリアルタイムグラフ表示、そして美しい多言語対応GUIインターフェースを搭載しています。

## 特徴

### ゲーム機能
- **美しいGUI**: egui/eframeを使用した直感的なインターフェース 🎮
- **リアルタイム表示**: ゲーム盤面、統計、グラフのリアルタイム表示
- **高速ビット演算**: 64ビット整数を使用した高速な盤面計算
- **強力なAI**: ミニマックス法＋アルファベータ枝刈り＋トランスポジションテーブル
- **多段階難易度**: レベル1（初級）からレベル13（超超超超上級）まで
- **人間 vs AI**: 人間対コンピュータの対戦
- **AI vs AI**: コンピュータ同士の対戦観戦

### GUI機能 ✨
- **🌐 多言語対応**: 日本語⇔英語のリアルタイム切り替え
- **ビジュアル盤面**: マウスクリックで石を配置
- **合法手表示**: 置ける場所をゴールドの円で表示
- **リアルタイム統計**: 思考時間、手数、石数のリアルタイム表示
- **📊 内蔵プロットビューア**: egui_plotによる高性能なリアルタイムグラフ表示
- **インタラクティブグラフ**: ズーム・パン・凡例表示対応
- **非同期AI思考**: UIをブロックしないAI処理

### 統計・グラフ機能 📊
- **📈 リアルタイム内蔵グラフ**: egui_plotによる高性能表示
- **石数推移グラフ**: ゲーム中の黒石・白石の数の変化を可視化
- **思考時間グラフ**: 各手の思考時間の推移を表示（平均線付き）
- **AI評価値グラフ**: AIの局面評価の変化を追跡
- **総合統計ビュー**: 複数の情報を一画面で表示
- **インタラクティブ操作**: ズーム・パン・データポイント詳細表示
- **多言語対応**: グラフのラベル・凡例も完全翻訳

## 必要な環境

- Rust 1.70以上
- Cargo

## インストール

```bash
git clone <repository-url>
cd bitothello
cargo build --release
```

## 使用方法

### GUI版ゲーム（推奨） 🎮
```bash
cargo run -- gui
```
美しいグラフィカルインターフェースでゲームを楽しめます。

### コマンドライン版ゲーム
```bash
cargo run
```
従来のテキストベースインターフェース。

### クイックテスト（AI vs AI 短期戦）
```bash
cargo run -- quick-game
```

### グラフ生成テスト
```bash
cargo run -- test-graphs
```

## ゲームの進行

### GUI版
1. **プレイヤー設定**: ドロップダウンメニューで黒・白それぞれのプレイヤータイプを選択
   - 人間プレイヤー
   - AI（レベル1〜13）
   - カスタムAI（深さスライダーで指定）

2. **ゲーム進行**: 
   - 人間の場合: 盤面上の合法手（ゴールドの円）をマウスクリック
   - AIの場合: 自動で思考・実行（思考中はスピナー表示）

3. **ゲーム終了**: 
   - リアルタイム統計の表示
   - **「統計・グラフ表示」ボタンでグラフビューア起動** 🎯
   - グラフビューア内で画像の切り替え・ズーム機能

### コマンドライン版
1. **プレイヤー設定**: 数字入力で黒・白それぞれのプレイヤータイプを選択
2. **ゲーム進行**: 
   - 人間の場合: 行列座標を入力（例: `3 2`）
   - AIの場合: 自動で最適手を選択・実行
3. **ゲーム終了**: 
   - 基本統計の表示
   - 詳細統計の表示
   - **グラフファイルの自動生成** 🎯

### 内蔵グラフ機能

ゲーム終了後、GUI内で以下のリアルタイムグラフを表示：

- **石数推移**: 黒・白の石数変化をリアルタイム表示
- **思考時間**: 各手の思考時間と平均値を可視化
- **AI評価値**: AIの局面評価値推移（AI戦時のみ）
- **総合ビュー**: 複数グラフの同時表示

### 内蔵グラフの特徴

#### 📈 高性能表示
- **egui_plot**: Rustネイティブの高速グラフライブラリ
- **リアルタイム更新**: ゲーム進行に応じた即座更新
- **インタラクティブ操作**: マウスホイールでズーム、ドラッグでパン
- **固定境界制御**: グラフの継続的な拡張を防ぐ固定範囲モード 🔧
- **動的スケーリング**: データ範囲に応じた最適な軸設定（自動モード）

#### 石数推移グラフ
- 黒線: 黒石の数
- 青線: 白石の数
- 凡例表示・多言語対応

#### 思考時間グラフ
- 赤線: 各手の思考時間
- 緑線: 平均思考時間（動的計算）
- 統計情報の併時表示

#### AI評価値グラフ
- 黒線: 黒AIの評価値
- 青線: 白AIの評価値
- グレー線: ゼロライン
- AI統計サマリー付き

#### グラフ制御機能 🔧
- **固定境界モード**: グラフの範囲を固定し、継続的な拡張を防止
  - 石数グラフ: 0-64石の固定範囲
  - 思考時間グラフ: 最大値+10%の固定範囲
  - 評価値グラフ: データ範囲+10%の固定範囲
- **自動境界モード**: データに応じた動的な範囲調整
- **リセット機能**: グラフ表示の即座リフレッシュ
- **トグル切り替え**: ワンクリックでモード変更

## コマンド（ゲーム中）

### 人間プレイヤー
- `行 列`: 石を置く（例: `3 2`）
- `h` または `help`: ヘルプ表示・合法手一覧
- `q` または `quit`: ゲーム終了

## AI レベル

| レベル | 難易度 | 特徴 |
|--------|--------|------|
| 1 | 初級 | 簡単な手の評価のみ |
| 3 | 中級 | 3手先読み |
| 5 | 上級 | 5手先読み |
| 7 | 超上級 | 7手先読み |
| 9 | 超超上級 | 9手先読み |
| 11 | 超超超上級 | 11手先読み |
| 13 | 超超超超上級 | 13手先読み |
| カスタム | - | 1-20手先まで任意指定 |

## 技術仕様

### 最適化技術
- **ビット演算**: 盤面を64ビット整数で表現
- **ミニマックス法**: ゲーム木探索
- **アルファベータ枝刈り**: 探索効率化
- **トランスポジションテーブル**: 局面記憶による高速化
- **Move Ordering**: 手の順序最適化
- **適応的深度調整**: 終盤での探索深度増加

### 統計記録
- 手番・位置・思考時間・石数・AI評価値を全て記録
- パスも含めた完全なゲーム履歴
- リアルタイムでの統計計算

### グラフ生成技術
- **Plotters クレート**: 高品質なグラフ描画
- **自動スケーリング**: データ範囲に応じた軸調整
- **タイムスタンプ**: ファイル名の重複防止
- **複数形式**: 個別グラフ + 総合ビュー

## 開発

### 依存関係
```toml
[dependencies]
rand = "0.8.5"
rayon = "1.7.0"
plotters = "0.3"
chrono = "0.4"
eframe = "0.24"
egui = "0.24"
egui_extras = "0.24"
egui_plot = "0.24"
image = "0.24"
```

### モジュール構成
- `main.rs` - メイン処理・UI・ルーティング
- `board.rs` - 盤面管理・ビット演算
- `player.rs` - プレイヤー管理
- `ai.rs` - AI思考エンジン
- `gui/` - GUIインターフェース 🎮
  - `app.rs` - メインアプリケーション・多言語対応
  - `game_view.rs` - ゲーム盤面表示
  - `plot_viewer.rs` - 内蔵グラフ表示・ビューア
- `stats/` - 統計・グラフ生成
  - `game_stats.rs` - 統計データ構造
  - `plotter.rs` - グラフ描画

## ライセンス

MIT License

## 更新履歴

### v0.4.1 🔧
- 🔧 **グラフ境界制御**: 継続的な拡張を防ぐ固定範囲モード追加
- ⚡ **最適化された再描画**: 不要な画面更新を削減
- 🎯 **安定したグラフ表示**: ちらつきや伸び続ける問題を解決
- 📊 **改良されたUI**: グラフ制御オプションの追加

### v0.4.0 🎮
- ✨ **多言語GUI**: 日本語⇔英語のリアルタイム切り替え
- 📊 **内蔵グラフ**: egui_plotによる高性能リアルタイム表示
- 🖱️ **インタラクティブグラフ**: ズーム・パン・凡例対応
- 🌐 **完全翻訳**: UI・グラフラベル・メッセージの多言語対応
- ⚡ **高速描画**: 外部ファイル不要のネイティブ描画
- 🎯 **統合UI**: ゲーム・統計・グラフの一体化

### v0.3.0 🎮
- ✨ **GUI実装**: egui/eframeを使用した美しいインターフェース
- 🖱️ **マウス操作**: クリックで石を配置
- 📊 **外部グラフ**: plottersによるPNGファイル生成
- 🔍 **画像ビューア**: 生成グラフの表示機能
- ⚡ **非同期処理**: AIの思考中もUIが応答
- 🎯 **リアルタイム表示**: 統計・ゲーム状況のリアルタイム更新

### v0.2.0
- ✨ **外部グラフ生成機能追加**
- 📊 石数・思考時間・評価値のPNG出力
- 🎯 自動スケーリング機能
- 🚀 クイックテストモード

### v0.1.0
- 基本的なオセロゲーム実装
- AI対戦機能
- ビット演算最適化